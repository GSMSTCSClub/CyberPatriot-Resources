var getQSParams=function(){for(var e,r=window.location.search.substring(1).split("&"),t={},a=0;a<r.length;a++){e=r[a];var n=e.split("=");t[n[0]]=n[1]}return t},getURL=function(){var e=getQSParams()||{};return{size:e.size,url:"/reviews/api?apiKey=ZTU3MThjMWEtOTc1ZS00YzgwLWIzZGEtNDg0ODlkMDc0ODRk&paramsKey="+e.widget_id}},getData=function(){var e=getURL(),r=new XMLHttpRequest;r.onreadystatechange=function(){4==this.readyState&&(200==this.status?postData(e.size,r.responseText):postError())},r.onerror=function(){postError()},r.open("GET",e.url),r.send()},postError=function(){parent.postMessage(JSON.stringify({error:!0}),"*")},getVendorData=function(e){return e=e||{},e.vendorReviews&&e.vendorReviews[0]?e.vendorReviews[0]:null},getScoreData=function(e){return e=e||{},e.vendorValues&&e.vendorValues["would-recommend"]&&e.vendorValues["would-recommend"][0]?e.vendorValues["would-recommend"][0]:null},processSmallWidgetData=function(e){e=e||{};var r=getVendorData(e),t=getScoreData(e),a={};return r&&t&&t.count&&(a={url:r.readUrl,seoName:r.seoName,rating:r.avgRating,reviewCount:r.reviewCount,name:r.name,market:e.name,score:t.value,numRecommended:t.count}),a},processLargeWidgetData=function(e){e=e||{};var r=[],t=getVendorData(e);if(t)for(var a=0;a<t.reviews.length;a++){var n=t.reviews[a];r.push({headline:n.headline,rating:n.rating,date:n.dateReviewed})}return{vendor:processSmallWidgetData(e),reviews:r}},postData=function(e,r){var t=JSON.parse(r),a={};t?(t.data?"large"===e?(a=processLargeWidgetData(t.data),a.error=0==Object.keys(a.vendor).length):(a=processSmallWidgetData(t.data),a.error=0==Object.keys(a).length):a.error=!0,t.widgetId&&(a.widgetId=t.widgetId)):a.error=!0,parent.postMessage(JSON.stringify(a),"*")};